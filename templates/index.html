<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI BOOST</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            height: calc(100vh - 40px);
        }

        .sidebar {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow-y: auto;
        }

        .main-chat {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-radius: 12px 12px 0 0;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            word-wrap: break-word;
        }

        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-left: 3px solid #28a745;
        }

        .assistant-message {
            align-self: flex-start;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-left: 3px solid #28a745;
        }

        .chat-input-container {
            padding: 20px;
            border-top: 1px solid #e0e0e0;
            background: #f8f9fa;
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .chat-input:focus {
            border-color: #28a745;
        }

        .btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s ease;
            font-weight: 500;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }

        .api-key-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .api-key-section h3 {
            color: #28a745;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .api-key-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .api-key-input:focus {
            outline: none;
            border-color: #28a745;
        }

        .status-indicator {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-connected {
            background: #d4edda;
            color: #155724;
        }

        .status-disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        .file-upload-section {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .file-upload-section h3 {
            color: #28a745;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .file-input {
            width: 100%;
            padding: 8px;
            border: 2px dashed #28a745;
            border-radius: 8px;
            margin-bottom: 10px;
            background: white;
        }

        .loading {
            display: none;
            color: #28a745;
            font-style: italic;
        }

        .error {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
        }

        .success {
            color: #28a745;
            font-size: 12px;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .sidebar {
                order: 2;
                max-height: 300px;
            }
            
            .main-chat {
                order: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="api-key-section">
                <h3>OpenAI API Key</h3>
                <textarea id="apiKey" class="api-key-input" placeholder="Enter your OpenAI API key here..." rows="3"></textarea>
                <div id="apiStatus" class="status-indicator status-disconnected">Not Connected</div>
            </div>

            <div class="file-upload-section">
                <h3>Upload File</h3>
                <input type="file" id="fileInput" class="file-input" accept=".pdf,.txt">
                <button onclick="uploadFile()" class="btn btn-secondary" style="width: 100%;">Upload</button>
                <div id="uploadStatus"></div>
            </div>

            <div style="margin-top: 20px;">
                <button onclick="clearChat()" class="btn btn-secondary" style="width: 100%;">Clear Chat</button>
            </div>
        </div>

        <div class="main-chat">
            <div class="header">
                <h1>AI BOOST</h1>
            </div>

            <div id="chatMessages" class="chat-messages">
                <div class="assistant-message">
                    <strong>AI Assistant:</strong> Hello! I'm AI BOOST, your advanced AI assistant with knowledge updated through 2025. I can help you with current information, recent developments, and analyze documents. Please enter your OpenAI API key in the sidebar to get started. You can also upload PDF or text files for me to analyze.
                </div>
            </div>

            <div class="chat-input-container">
                <div class="input-group">
                    <input type="text" id="messageInput" class="chat-input" placeholder="Type your message here..." onkeypress="handleKeyPress(event)">
                    <button onclick="sendMessage()" class="btn">Send</button>
                </div>
                <div id="loading" class="loading">AI is thinking...</div>
                <div id="errorMessage" class="error"></div>
            </div>
        </div>
    </div>

    <script>
        let uploadedContent = '';
        
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function updateApiStatus() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const statusEl = document.getElementById('apiStatus');
            
            if (apiKey) {
                statusEl.textContent = 'Connected';
                statusEl.className = 'status-indicator status-connected';
            } else {
                statusEl.textContent = 'Not Connected';
                statusEl.className = 'status-indicator status-disconnected';
            }
        }

        document.getElementById('apiKey').addEventListener('input', updateApiStatus);

        async function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const apiKey = document.getElementById('apiKey').value.trim();
            const message = messageInput.value.trim();
            
            if (!message) {
                showError('Please enter a message');
                return;
            }
            
            if (!apiKey) {
                showError('Please enter your OpenAI API key');
                return;
            }

            // Clear input and show loading
            messageInput.value = '';
            showLoading(true);
            clearError();

            // Add user message to chat
            addMessageToChat('user', message);

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        api_key: apiKey,
                        uploaded_content: uploadedContent
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    addMessageToChat('assistant', data.ai_response);
                } else {
                    showError(data.error || 'An error occurred');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function addMessageToChat(role, content) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}-message`;
            
            const roleLabel = role === 'user' ? 'You' : 'AI Assistant';
            messageDiv.innerHTML = `<strong>${roleLabel}:</strong> ${content}`;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
        }

        function clearError() {
            document.getElementById('errorMessage').textContent = '';
        }

        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showUploadStatus('Please select a file', 'error');
                return;
            }

            showUploadStatus('Uploading...', 'loading');

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (response.ok) {
                    uploadedContent = data.full_content;
                    showUploadStatus(`File "${data.filename}" uploaded successfully!`, 'success');
                    fileInput.value = ''; // Clear file input
                } else {
                    showUploadStatus(data.error || 'Upload failed', 'error');
                }
            } catch (error) {
                showUploadStatus('Upload error: ' + error.message, 'error');
            }
        }

        function showUploadStatus(message, type) {
            const statusEl = document.getElementById('uploadStatus');
            statusEl.textContent = message;
            statusEl.className = type;
        }

        async function clearChat() {
            try {
                const response = await fetch('/clear_chat', {
                    method: 'POST'
                });

                if (response.ok) {
                    document.getElementById('chatMessages').innerHTML = `
                        <div class="assistant-message">
                            <strong>AI Assistant:</strong> Chat cleared! How can I help you today?
                        </div>
                    `;
                    uploadedContent = '';
                    showUploadStatus('', '');
                }
            } catch (error) {
                showError('Failed to clear chat');
            }
        }

        // Load existing messages on page load
        window.addEventListener('load', async () => {
            try {
                const response = await fetch('/get_messages');
                const data = await response.json();
                
                if (data.api_key) {
                    document.getElementById('apiKey').value = data.api_key;
                    updateApiStatus();
                }
                
                if (data.messages && data.messages.length > 0) {
                    const chatMessages = document.getElementById('chatMessages');
                    chatMessages.innerHTML = '';
                    
                    data.messages.forEach(msg => {
                        addMessageToChat(msg.role, msg.content);
                    });
                }
            } catch (error) {
                console.log('No existing session data');
            }
        });
    </script>
</body>
</html>
